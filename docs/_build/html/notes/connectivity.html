

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Block to Block Connectivity &mdash; Plot3D 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/_static/style.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plot3D.Connectivity" href="../modules/connectivity.html" />
    <link rel="prev" title="Reading and Writing Plot3D Files" href="reading_writing.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Plot3D
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-via-pip">Installation via Pip</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plot3d.html">Plot3D Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="reading_writing.html">Reading and Writing Plot3D Files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Block to Block Connectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="#periodicity">Periodicity</a></li>
<li class="toctree-l1"><a class="reference internal" href="#exporting-to-glennht-connectivity-files">Exporting to GlennHT Connectivity Files</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/connectivity.html">Plot3D.Connectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/block.html">Plot3D.Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/differencing.html">Plot3D.Differencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/face.html">Plot3D.Face</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/read.html">Plot3D.Read</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/write.html">Plot3D.Write</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Plot3D</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Block to Block Connectivity</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/notes/connectivity.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="block-to-block-connectivity">
<h1>Block to Block Connectivity<a class="headerlink" href="#block-to-block-connectivity" title="Permalink to this headline">¶</a></h1>
<p>Computational Grids are often divided into blocks for easier gridding. It is important to know how these blocks connect with each other in order to model the transfer of information. Computational Fluid Dynamics (CFD) requires the solver to know the “connectivity” of these blocks.</p>
<p>The plot3D python library has a function for determining the connectivity. This is found by taking the combination of each block with another block and scanning the nodes on the exterior faces of block 1 with the exterior face of block 2. If there is a match then the two faces are connected. The code can search for <em>full face matches</em> or <em>partial matching</em>. <em>Full face matching</em> is much faster and should be used if your grid has a definite match.</p>
<p>Below is an example of a turbine domain with two blocks: HGrid in (red) and ogrid in (white). The two share a connected face with partial matching. There’s also the o-mesh which within itself has a connected face.</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/turbine_domain-blocking.png"><img alt="Two blocks, one in red for h mesh and white for omesh" src="../_images/turbine_domain-blocking.png" style="width: 800px;" /></a>
</div>
<p>To find connectivity simply call the function <em>connectivity</em> and pass in the blocks. This will return two things: face_matches and outer faces. Face matches are faces that are connected between the blocks. Outer faces are the remaining outer faces that aren’t connected to anything. This can take a long time to run for larger meshes.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="n">read_plot3D</span><span class="p">(</span><span class="s1">&#39;../../../testfiles/finalmesh.xyz&#39;</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">big_endian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Block 1 is the blade O-Mesh k=0</span>
<span class="c1"># outer_faces, _ = get_outer_faces(blocks[0]) # lets check</span>
<span class="n">face_matches</span><span class="p">,</span> <span class="n">outer_faces_formatted</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This is an example of the output. The figure below shows the block 1 and 2 matching faces found in the variable <em>face_matches</em>.</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/turbine_domain-matching1-2.png"><img alt="matching block 1 and block 2 faces" src="../_images/turbine_domain-matching1-2.png" style="width: 800px;" /></a>
</div>
<p>This is the matching face within the omesh</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/turbine_domain-matching1-1.png"><img alt="matching block 1 and block 2 faces" src="../_images/turbine_domain-matching1-1.png" style="width: 800px;" /></a>
</div>
</div>
<div class="section" id="periodicity">
<h1>Periodicity<a class="headerlink" href="#periodicity" title="Permalink to this headline">¶</a></h1>
<p>The domain above has a periodicity on the side walls and from block 1 to block 2 on the suction side. Plot3D library can find periodic surfaces. Periodic surfaces can only be found by rotation about the x-axis. The user also needs to specify which direction is periodic either <em>i</em>, <em>j</em>, or <em>k</em>. Combinations of outer faces are searched to find the ones that are periodic when rotated about the x-axis and in the “k” direction (default option). Below is an example on how to find periodic surfaces.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plot3d</span> <span class="kn">import</span> <span class="n">write_plot3D</span><span class="p">,</span> <span class="n">read_plot3D</span><span class="p">,</span> <span class="n">find_periodicity</span><span class="p">,</span> <span class="n">connectivity</span>

<span class="n">blocks</span> <span class="o">=</span> <span class="n">read_plot3D</span><span class="p">(</span><span class="s1">&#39;../../../testfiles/finalmesh.xyz&#39;</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">big_endian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">face_matches</span><span class="p">,</span> <span class="n">outer_faces_formatted</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
<span class="n">periodic_surfaces</span><span class="p">,</span> <span class="n">outer_faces_to_keep</span> <span class="o">=</span> <span class="n">find_periodicity</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span><span class="n">outer_faces</span><span class="p">,</span><span class="n">periodic_direction</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># Append periodic surfaces to face_matches</span>
<span class="n">face_matches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">periodic_surfaces</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/turbine_domain-periodic-block1-2.png"><img alt="periodic surface from block 1 to block 2" src="../_images/turbine_domain-periodic-block1-2.png" style="width: 800px;" /></a>
</div>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/turbine_domain-periodic-block2-inlet.png"><img alt="periodic surface block 2 entrance of the domain" src="../_images/turbine_domain-periodic-block2-inlet.png" style="width: 800px;" /></a>
</div>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/turbine_domain-periodic-block2-outlet.png"><img alt="periodic surface block 2 exit of the domain" src="../_images/turbine_domain-periodic-block2-outlet.png" style="width: 800px;" /></a>
</div>
</div>
<div class="section" id="exporting-to-glennht-connectivity-files">
<h1>Exporting to GlennHT Connectivity Files<a class="headerlink" href="#exporting-to-glennht-connectivity-files" title="Permalink to this headline">¶</a></h1>
<p>This is an example of how I read a mesh, convert it to ascii, save it, find connectivity, find periodicty and export to glennht format.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;../../&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">plot3d</span> <span class="kn">import</span> <span class="n">write_plot3D</span><span class="p">,</span> <span class="n">read_plot3D</span><span class="p">,</span> <span class="n">find_periodicity</span>
<span class="kn">from</span> <span class="nn">plot3d</span> <span class="kn">import</span> <span class="n">find_matching_blocks</span><span class="p">,</span> <span class="n">get_outer_faces</span><span class="p">,</span> <span class="n">connectivity</span>
<span class="kn">from</span> <span class="nn">glennht_con</span> <span class="kn">import</span> <span class="n">export_to_glennht_conn</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Convert to binary because of size</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="n">read_plot3D</span><span class="p">(</span><span class="s1">&#39;../../../testfiles/finalmesh.xyz&#39;</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">write_plot3D</span><span class="p">(</span><span class="s1">&#39;../../../testfiles/finalmesh.xyz&#39;</span><span class="p">,</span><span class="n">blocks</span><span class="p">,</span><span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;connectivity.pickle&#39;</span><span class="p">):</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="n">read_plot3D</span><span class="p">(</span><span class="s1">&#39;../../../testfiles/finalmesh.xyz&#39;</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">big_endian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Block 1 is the blade O-Mesh k=0</span>
    <span class="c1"># outer_faces, _ = get_outer_faces(blocks[0]) # lets check</span>
    <span class="n">face_matches</span><span class="p">,</span> <span class="n">outer_faces_formatted</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;connectivity.pickle&#39;</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s2">&quot;face_matches&quot;</span><span class="p">:</span><span class="n">face_matches</span><span class="p">,</span> <span class="s2">&quot;outer_faces&quot;</span><span class="p">:</span><span class="n">outer_faces_formatted</span><span class="p">},</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;connectivity.pickle&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">face_matches</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;face_matches&#39;</span><span class="p">]</span>
    <span class="n">outer_faces</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;outer_faces&#39;</span><span class="p">]</span>

<span class="n">blocks</span> <span class="o">=</span> <span class="n">read_plot3D</span><span class="p">(</span><span class="s1">&#39;../../../testfiles/finalmesh.xyz&#39;</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">big_endian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">periodic_surfaces</span><span class="p">,</span> <span class="n">outer_faces_to_keep</span> <span class="o">=</span> <span class="n">find_periodicity</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span><span class="n">outer_faces</span><span class="p">,</span><span class="n">periodic_direction</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># Append periodic surfaces to face_matches</span>
<span class="n">face_matches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">periodic_surfaces</span><span class="p">)</span>

<span class="n">export_to_glennht_conn</span><span class="p">(</span><span class="n">face_matches</span><span class="p">,</span><span class="n">outer_faces_to_keep</span><span class="p">,</span><span class="s1">&#39;finalmesh&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="k">def</span> <span class="nf">export_to_glennht_conn</span><span class="p">(</span><span class="n">nblocks</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">matches</span><span class="p">:</span><span class="n">List</span><span class="p">,</span><span class="n">block_surfaces</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span><span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">other_settings</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exports the connectivity to GlennHT format</span>

<span class="sd">    Args:</span>
<span class="sd">        matches (dict): Any matching faces between blocks</span>
<span class="sd">        block_surfaces (dict): Non matching faces of all blocks or surfaces to consider</span>
<span class="sd">        filename (str): filename to write to</span>
<span class="sd">        other_settings (dict, optional): contains general interfaces, zones, blocks that are in the zone. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;block1&#39;</span><span class="p">,</span><span class="s1">&#39;block2&#39;</span><span class="p">]</span> <span class="c1"># Block 1 and Block 2 are arbitrary names. Their index matters</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.ght_conn&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="c1"># Print matches</span>
        <span class="n">nMatches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">nMatches</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># Print number of matches</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
                <span class="n">block_indx</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># block1 and block2 are arbitrary names, the key is the block index</span>
                <span class="n">block_IMIN</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;IMIN&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">block_JMIN</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;JMIN&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">block_KMIN</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;KMIN&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>

                <span class="n">block_IMAX</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;IMAX&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">block_JMAX</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;JMAX&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">block_KMAX</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;KMAX&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>

                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">block_indx</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">block_IMIN</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">block_JMIN</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">block_KMIN</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">block_IMAX</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">block_JMAX</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">block_KMAX</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Print Surfaces</span>
        <span class="c1"># Get total number of surfaces</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">block_surfaces</span><span class="p">:</span>
            <span class="n">block_indx</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;surfaces&#39;</span><span class="p">]:</span>
                <span class="n">IMIN</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;IMIN&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">JMIN</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;JMIN&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">KMIN</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;KMIN&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>

                <span class="n">IMAX</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;IMAX&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">JMAX</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;JMAX&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">KMAX</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;KMAX&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">block_indx</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">IMIN</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">JMIN</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">KMIN</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">IMAX</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">JMAX</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">KMAX</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">id</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">id</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>

        <span class="c1"># Write general interfaces</span>
        <span class="n">n_gif</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_settings</span><span class="p">[</span><span class="s1">&#39;general_interfaces&#39;</span><span class="p">])</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_gif</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gif</span> <span class="ow">in</span> <span class="n">other_settings</span><span class="p">[</span><span class="s1">&#39;general_interfaces&#39;</span><span class="p">]:</span>
            <span class="n">surf1</span> <span class="o">=</span> <span class="n">gif</span><span class="p">[</span><span class="s1">&#39;surface_pairs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">surf2</span> <span class="o">=</span> <span class="n">gif</span><span class="p">[</span><span class="s1">&#39;surface_pairs&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">gif</span><span class="p">[</span><span class="s1">&#39;gif_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mixing_plane&#39;</span><span class="p">:</span>
                <span class="n">gif_kind</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gif_kind</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># for conjugate</span>
            <span class="k">if</span> <span class="n">gif</span><span class="p">[</span><span class="s1">&#39;is_polar&#39;</span><span class="p">]:</span>
                <span class="n">gif_kind</span><span class="o">*=-</span><span class="mi">1</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">surf1</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">surf2</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">gif_kind</span><span class="si">}</span><span class="s1"> 1 &#39;</span><span class="p">)</span> <span class="c1"># Assume no new lines and just write on a single line.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_settings</span><span class="p">[</span><span class="s1">&#39;general_interfaces&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">zonetype_to_glennht</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;fluid&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;1&#39;</span>
            <span class="k">else</span><span class="p">:</span>                   <span class="c1"># Second zone is solid</span>
                <span class="k">return</span> <span class="s1">&#39;2&#39;</span>

        <span class="k">def</span> <span class="nf">lookup_zone_index</span><span class="p">(</span><span class="n">block_indx</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;Searches through all the zones for the block_index</span>

<span class="sd">            Args:</span>
<span class="sd">                block_indx (int): index of block</span>

<span class="sd">            Returns:</span>
<span class="sd">                int: the zone index</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">zone_indx</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">other_settings</span><span class="p">[</span><span class="s1">&#39;zones&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">block_indx</span> <span class="ow">in</span> <span class="n">zone</span><span class="p">[</span><span class="s1">&#39;blocks&#39;</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="n">zone_indx</span>
                <span class="n">zone_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Write the Zones</span>
        <span class="n">n_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_settings</span><span class="p">[</span><span class="s1">&#39;zones&#39;</span><span class="p">])</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_zones</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">other_settings</span><span class="p">[</span><span class="s1">&#39;zones&#39;</span><span class="p">]:</span>    <span class="c1"># Write which zone is fluid and which is solid</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zonetype_to_glennht</span><span class="p">(</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_settings</span><span class="p">[</span><span class="s1">&#39;zones&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Write out which block belongs to what zone index</span>
        <span class="k">for</span> <span class="n">block_indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nblocks</span><span class="p">):</span>
            <span class="n">zone_index</span> <span class="o">=</span> <span class="n">lookup_zone_index</span><span class="p">(</span><span class="n">block_indx</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">block_indx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">zone_index</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">zone_index</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../modules/connectivity.html" class="btn btn-neutral float-right" title="Plot3D.Connectivity" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="reading_writing.html" class="btn btn-neutral float-left" title="Reading and Writing Plot3D Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Paht Juangphanich.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>